var mxml,code="";var wprop,selectedComponent,elements;var excluded=["Panel","ColorPicker","DataGrid","ComboBox","Application","NumericStepper","Label","TextArea","TextInput","Image"];
editor=null;var _x=0;var _y=0;$(function(){deleteElements();if(!editor){editor=CodeMirror.fromTextArea(document.getElementById("source_code"),{mode:{name:"xml",alignCDATA:true},theme:"eclipse",autoCloseTags:true,lineNumbers:true,lineWrapping:true,extraKeys:{"Ctrl-Space":"autocomplete"}});
}$.get("js/ui/flexui.html",function(a){$(".sidetab").append(a);$("#components").treeview({animated:"fast",control:"h4"});$(".dragg").disableSelection();
$(".dragg").draggable({cursor:"move",drag:function(c,b){b.helper.width(200);},helper:"clone",snap:true,stop:handleDropEvent});});showProperties();$("#switchViews a:first").on("shown",function(){if(wprop!==undefined){$("#properties").hide();
}CodeMirror.commands.autocomplete=function(a){CodeMirror.showHint(a,CodeMirror.mxmlHint);};getCode();editor.refresh();});$("#switchViews a:last").on("click",function(){$("#properties").show();
});$("#switchViews a:last").tab("show");$(".CodeMirror").height($(document).height()-80);$("#design").height($(document).height()-5);$(window).on("resize",function(){$(".CodeMirror").height($(document).height()-80);
$("#design").height($(document).height()-5);$("#properties").css("top","30%");$("#properties").css("left","70%");});$("#design").droppable({greedy:true,drop:handleDropEvent});
$("#props").on("switch-change",function(d,c){var b=c.value;var a=b===true?"visible":"hidden";$("#properties").css("visibility",a);});$("#comps").on("switch-change",function(d,c){var b=c.value;
var a=b===true?"visible":"hidden";if(b){$("#designer").removeClass("span12").addClass("span10");}else{$("#designer").removeClass("span10").addClass("span12");
}$("#components").css("visibility",a);});$(document).on("click",".ui",function(a){a.preventDefault();$("#design .ui").each(function(){$(this).freetrans("controls",false);
});if(wprop!==undefined){$("#properties .row").html(reflectProperties($(a.currentTarget)));$("#properties").height($("#properties form").height()+15);}$(a.currentTarget).freetrans("controls",true);
a.stopImmediatePropagation();});$(document).on("click","#design",function(a){a.preventDefault();selectedComponent="";$(".ui").each(function(){$(this).freetrans("controls",false);
});if(wprop!==undefined){$("#properties .row").html(reflectProperties($(a.currentTarget)));$("#properties").height($("#properties form").height()+25);}a.stopImmediatePropagation();
});$(document).on("blur",".input-mini",function(j){var c,a,i,d;if($(this).attr("name")==="x"){c=Math.round(parseFloat($(this).val()));}if($(this).attr("name")==="y"){a=Math.round(parseFloat($(this).val()));
}if($(this).attr("name")==="width"){i=$(this).val();$(document).find("#"+selectedComponent).css({width:$(this).val()});$(document).find("#"+selectedComponent).next().css("width",$(this).val());
}if($(this).attr("name")==="height"){$(document).find("#"+selectedComponent).css("height",$(this).val());$(document).find("#"+selectedComponent).next().css("height",$(this).val());
d=$(this).val();}if($(this).attr("name")==="top"){$(document).find("#"+selectedComponent).css("top",$(this).val());$(document).find("#"+selectedComponent).next().css("top",$(this).val());
}if($(this).attr("name")==="left"){$(document).find("#"+selectedComponent).css("left",$(this).val());$(document).find("#"+selectedComponent).next().css("left",$(this).val());
}if($(document).find("#"+selectedComponent).data("type")==="Label"&&$(this).attr("name")==="text"){$(document).find("#"+selectedComponent).text($(this).val());
}if($(document).find("#"+selectedComponent).data("type")==="Button"&&$(this).attr("name")==="label"){$(document).find("#"+selectedComponent).text($(this).val());
}if($(document).find("#"+selectedComponent).data("type")==="CheckBox"&&$(this).attr("name")==="label"){var l=$(this).val();$(document).find("#"+selectedComponent).find("span").text(l);
}if($(document).find("#"+selectedComponent).data("type")==="Panel"&&$(this).attr("name")==="title"){var n=$(this).val();$(document).find("#"+selectedComponent).find(".panel-title").text(n);
}if($(document).find("#"+selectedComponent).data("type")==="Image"&&$(this).attr("name")==="src"){var b=$(this).val()==="http://placehold.it/200x200"?"http://placehold.it/"+i+"x"+d:$(this).val();
$(document).find("#"+selectedComponent).find("img").attr("src",b);}if($(this).attr("name")!=="x"&&$(this).attr("name")!=="y"){$(document).find("#"+selectedComponent).attr($(this).attr("name"),$(this).val());
}if($(this).attr("name")==="enabled"||$(this).attr("name")==="visible"||$(this).attr("name")==="prompt"||$(this).attr("name")==="requestedRowCount"){$(document).find("#"+selectedComponent).attr($(this).attr("name"),$(this).val());
}if($(this).attr("name")==="requestedRowCount"){var m=$(this).val();var g="";var o="";for(var f=1;f<=m;f++){g+="<th>Column"+f+"</th>\n";o+="<td>Item "+f+"</td>\n";
}$(document).find("#"+selectedComponent).find("tr:first").html(g);$(document).find("#"+selectedComponent).find("tr:gt(0)").html(o);}$(document).find("#"+selectedComponent).freetrans({x:c,y:a}).css({width:i,height:d});
});});function showProperties(){$.get("js/ui/properties.html",function(a){if(wprop===undefined){wprop=a;$("body").append($(wprop));$("#properties").draggable({containment:"#design",handle:".prop_title"});
$(".prop_title").disableSelection();}else{$("#properties").show();}});}function handleDropEvent(c,d){var b=d.draggable;var a=$("#design").offset();_x=Math.floor(d.position.left-a.left);
_y=Math.floor(d.position.top-a.top);w=Math.floor(d.width);h=Math.floor(d.height);switch($(b).data("type")){case"button":$btn=$(UI.button());alignEl($btn);
break;case"checkbox":$check=$(UI.checkbox());alignEl($check);break;case"colorpicker":$cpiker=$(UI.colorpicker());alignEl($cpiker);break;case"combobox":$cbx=$(UI.combobox());
alignEl($cbx);break;case"datagrid":$dg=$(UI.datagrid());alignEl($dg);break;case"numericstepper":$ntp=$(UI.numericstepper());alignEl($ntp);break;case"label":$lbl=$(UI.label());
alignEl($lbl);break;case"textinput":$txti=$(UI.textinput());alignEl($txti);break;case"textarea":$txta=$(UI.textarea());alignEl($txta);break;case"image":$imgs=$(UI.image("http://placehold.it/"+200+"x"+200));
alignEl($imgs);break;case"panel":$panel=$(UI.panel());alignEl($panel);break;}getCode();}function getCode(){parseToMXML();}function reflectProperties(b){selectedComponent=$(b).attr("id");
if(selectedComponent!==undefined){var a=new Object();a.id=$(b).attr("id")==="design"?"":$(b).attr("id");a.type=$(b).data("type")===undefined?"Application":$(b).data("type");
if($.inArray($("#"+selectedComponent).data("type"),excluded)===-1){a.label=$(b).text()===undefined?"":$(b).text();}if(a.type==="ComboBox"){a.prompt=$(b).attr("prompt")===undefined?"":$(b).attr("prompt");
}if(a.type==="DataGrid"){a.requestedRowCount=$(b).attr("requestedRowCount")===undefined?3:$(b).attr("requestedRowCount");}if(a.type==="Label"){a.text=$(b).text();
}if(a.type==="Panel"){a.title=$(b).find(".panel-title").text();}if(a.type==="Image"){a.src=$(b).find("img").attr("src");}a.width=Math.round(parseFloat($(b).css("width")));
a.height=Math.round(parseFloat($(b).css("height")));a.x=isNaN(Math.round(parseFloat($(b).css("left"))))?0:Math.round(parseFloat($(b).css("left")));a.y=isNaN(Math.round(parseFloat($(b).css("top"))))?0:Math.round(parseFloat($(b).css("top")));
a.enabled=a.enabled===true?false:true;}var c="";$.each(a,function(e,f){if(e!=="type"&&f!==undefined){var d;if(f.constructor!==Boolean){d='\t\t\t<input id="'+e+'" name="'+e+'" value="'+f+'" type="text" placeholder="" class="input-mini" required="">\n';
}else{d='\t\t\t<select class="input-mini" id="'+e+'"  name="'+e+'">\n\t\t<option>true</option>\n\t\t<option>false</option>\n';}c+='<div class="control-group">\n			 \t<label class="control-label">'+e+'</label>\n			 \t\t<div class="controls">\n'+d+"\n</div>\n";
}});return"<b>type: "+a.type+'</b>\n<form class="form-horizontal">\n		 <fieldset>\n'+c+"</fieldset></form>";}function parseToMXML(){mxml="";try{elements=new Array();
$("#design").find(".ui").each(function(f,g){item=new Object();item.type=$(g).data("type");item.id=$(g).attr("id");item.width=Math.round(parseFloat($(g).css("width")));
item.height=Math.round(parseFloat($(g).css("height")));item.x=Math.round(parseFloat($(g).css("left")));item.y=Math.round(parseFloat($(g).css("top")));item.label=$(g).text()!==""?'" label="'+$(g).text():"";
item.enabled=$(g).attr("enabled")!==undefined?' enabled="'+$(g).attr("enabled")+' "':" ";if($(g)!==undefined&&excluded.indexOf($(g).data("type"))===-1){item.tag="<s:"+item.type+item.enabled+' id="'+item.id+item.label+'" width="'+item.width+'" height="'+item.height+'" x="'+item.x+'" y="'+item.y+'"></s:'+item.type+">\n";
}else{item.tag="<s:"+item.type+' id="'+item.id+'" x="'+item.x+'" y="'+item.y+'"></s:'+item.type+">\n";}if($(g).data("type")==="Label"){item.text=$(g).text()!==""?'" text="'+$(g).text():"";
item.tag="<s:"+item.type+item.enabled+' id="'+item.id+item.text+'" x="'+item.x+'" y="'+item.y+'"></s:'+item.type+">\n";}if($(g).data("type")==="Panel"){item.title=$(g).find(".panel-title").text()!==""?'" title="'+$(g).find(".panel-title").text():"";
item.tag="<s:"+item.type+' id="'+item.id+item.title+'" x="'+item.x+'" y="'+item.y+'"></s:'+item.type+">\n";}if($(g).data("type")==="Image"){item.source=' source="'+$(g).find("img").attr("src")+'" ';
item.tag="<s:"+item.type+' id="'+item.id+'"'+item.source+'x="'+item.x+'" y="'+item.y+'" width="'+item.width+'" height="'+item.height+'"></s:'+item.type+">\n";
}if($(g).data("type")==="ComboBox"){item.prompt=$(g).attr("prompt")!==undefined?' prompt="'+$(g).attr("prompt")+'"':"";var l=$("#"+$(g).attr("id")).find("option");
var e="";$.map(l,function(i){e+="\t\t\t<fx:String>"+i.value+"</fx:String>\n";});item.tag="<s:"+item.type+' id="'+item.id+'"'+item.prompt+' x="'+item.x+'" y="'+item.y+'" width="'+item.width+'" height="'+item.height+'">\n\t<s:dataProvider>\n \t\t<s:ArrayList>\n'+e+"\t\t</s:ArrayList>\n\t</s:dataProvider>\n</s:"+item.type+">\n";
}if($(g).data("type")=="DataGrid"){var c="";item.requestedRowCount=$(g).attr("requestedRowCount")===undefined?3:$(g).attr("requestedRowCount");var k=item.requestedRowCount;
for(var d=1;d<=k;d++){c+='\t\t\t<s:GridColumn dataField="dataField'+d+'" headerText="ColumnName'+d+'"></s:GridColumn>\n';}item.tag="<s:"+item.type+' id="'+item.id+'" x="'+item.x+'" y="'+item.y+'" width="'+item.width+'" height="'+item.height+'">\n\t<s:columns>\n \t\t<s:ArrayList>\n'+c+"\t\t</s:ArrayList>\n\t</s:columns>\n\t\t<s:ArrayList>\n\t\t<!-- your itens here -->\n\t\t</s:ArrayList>\n</s:"+item.type+">\n";
}elements.push(item);$(elements[f]).each(function(j,i){});});mxml=UI.ApplicationStart();for(var b=0;b<elements.length;b++){mxml+=elements[b].tag;}mxml+=UI.ApplicationEnd();
editor.setValue(mxml);}catch(a){}}function deleteElements(){$(window).keyup(function(a){if(a.keyCode==46){$(document).find($("#"+selectedComponent)).freetrans("destroy");
$(document).find($("#"+selectedComponent)).remove();$("#properties .row").html(reflectProperties());}});}function alignEl(b){var a=_x;var c=_y;$("#design").append(b.css({top:c+"px",left:a+"px"}).on("click",function(){$(this).freetrans({x:$(this).position().left,y:$(this).position().top},"controls",true);
}));}